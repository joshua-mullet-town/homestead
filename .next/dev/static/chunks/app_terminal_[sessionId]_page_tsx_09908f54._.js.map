{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/joshuamullet/code/homestead/app/terminal/%5BsessionId%5D/page.tsx"],"sourcesContent":["'use client';\n\nimport { useEffect, useRef, useState, useCallback } from 'react';\nimport { useParams } from 'next/navigation';\nimport { io, Socket } from 'socket.io-client';\nimport { ZoomIn, ZoomOut } from 'lucide-react';\n\nexport default function TerminalPage() {\n  const params = useParams();\n  const sessionId = params.sessionId as string;\n  const terminalRef = useRef<HTMLDivElement>(null);\n  const xtermRef = useRef<any>(null);\n  const fitAddonRef = useRef<any>(null);\n  const socketRef = useRef<Socket | null>(null);\n  const [isConnected, setIsConnected] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n  const [fontSize, setFontSize] = useState(14);\n  const [showPreview, setShowPreview] = useState(false);\n\n  useEffect(() => {\n    let xterm: any;\n    let fitAddon: any;\n    let mounted = true;\n\n    const initTerminal = async () => {\n      try {\n        // Dynamically import xterm to avoid SSR issues\n        const [{ Terminal }, { FitAddon }] = await Promise.all([\n          import('@xterm/xterm'),\n          import('@xterm/addon-fit')\n        ]);\n\n        if (!mounted) return;\n\n        // Create terminal instance\n        xterm = new Terminal({\n          cols: 100,\n          rows: 30,\n          fontSize: fontSize,\n          fontFamily: 'Menlo, Monaco, \"Courier New\", monospace',\n          cursorBlink: true,\n          theme: {\n            background: '#1e1e1e',\n            foreground: '#d4d4d4',\n            cursor: '#d4d4d4',\n            cursorAccent: '#1e1e1e',\n            selectionBackground: 'rgba(255, 255, 255, 0.3)',\n          }\n        });\n\n        fitAddon = new FitAddon();\n        xterm.loadAddon(fitAddon);\n        fitAddonRef.current = fitAddon;\n\n        // Mount terminal\n        if (terminalRef.current) {\n          xterm.open(terminalRef.current);\n          fitAddon.fit();\n          xtermRef.current = xterm;\n        }\n\n        // Connect to Socket.IO - use current URL (for cloudflare tunnel) or local with port\n        const isCloudflare = typeof window !== 'undefined' && window.location.hostname.includes('trycloudflare.com');\n        const protocol = typeof window !== 'undefined' && window.location.protocol === 'https:' ? 'https' : 'http';\n\n        const socketUrl = isCloudflare\n          ? `${protocol}://${window.location.host}` // Use same host for cloudflare (no port)\n          : (typeof window !== 'undefined'\n              ? `${protocol}://${window.location.hostname}:3005` // Local with explicit port\n              : 'http://localhost:3005');\n\n        console.log('[Socket] Connecting to:', socketUrl);\n\n        const socket = io(socketUrl, {\n          transports: ['websocket', 'polling'],\n          path: '/socket.io' // Explicit path\n        });\n\n        socketRef.current = socket;\n\n        socket.on('connect', () => {\n          console.log('[Socket] Connected');\n          setIsConnected(true);\n          setError(null);\n\n          // Create terminal session (server will default to HOME directory)\n          socket.emit('terminal:create', sessionId);\n        });\n\n        socket.on('disconnect', () => {\n          console.log('[Socket] Disconnected');\n          setIsConnected(false);\n        });\n\n        socket.on('terminal:ready', (sid) => {\n          console.log('[Terminal] Ready:', sid);\n          xterm.write('\\r\\n\\x1b[1;32mTerminal connected!\\x1b[0m\\r\\n');\n        });\n\n        socket.on('terminal:output', (sid, data) => {\n          if (sid === sessionId) {\n            xterm.write(data);\n          }\n        });\n\n        socket.on('terminal:exit', (sid, { exitCode }) => {\n          console.log(`[Terminal] Exited with code ${exitCode}`);\n          xterm.write(`\\r\\n\\r\\n\\x1b[1;31mProcess exited with code ${exitCode}\\x1b[0m\\r\\n`);\n        });\n\n        socket.on('terminal:error', (sid, message) => {\n          console.error('[Terminal] Error:', message);\n          setError(message);\n          xterm.write(`\\r\\n\\x1b[1;31mError: ${message}\\x1b[0m\\r\\n`);\n        });\n\n        // Handle user input\n        xterm.onData((data: string) => {\n          socket.emit('terminal:input', sessionId, data);\n        });\n\n        // Handle resize\n        xterm.onResize(({ cols, rows }: { cols: number; rows: number }) => {\n          socket.emit('terminal:resize', sessionId, cols, rows);\n        });\n\n        // Handle window resize\n        const handleResize = () => {\n          if (fitAddon) {\n            fitAddon.fit();\n          }\n        };\n\n        window.addEventListener('resize', handleResize);\n\n        return () => {\n          window.removeEventListener('resize', handleResize);\n          if (socket) {\n            socket.emit('terminal:kill', sessionId);\n            socket.disconnect();\n          }\n          if (xterm) {\n            xterm.dispose();\n          }\n        };\n      } catch (err) {\n        console.error('[Terminal] Init error:', err);\n        setError(err instanceof Error ? err.message : 'Failed to initialize terminal');\n      }\n    };\n\n    initTerminal();\n\n    return () => {\n      mounted = false;\n    };\n  }, [sessionId]); // Removed fontSize from dependencies\n\n  // Handle font size change - update without reinitializing\n  useEffect(() => {\n    if (xtermRef.current && fitAddonRef.current) {\n      xtermRef.current.options.fontSize = fontSize;\n      // Refit terminal to adjust layout after font size change\n      setTimeout(() => {\n        if (fitAddonRef.current) {\n          fitAddonRef.current.fit();\n        }\n      }, 100);\n    }\n  }, [fontSize]);\n\n  // Handle sending messages from voice recorder\n  const handleSendMessage = useCallback((message: string) => {\n    if (socketRef.current && message.trim()) {\n      // Send each character individually to simulate typing\n      message.split('').forEach((char, index) => {\n        setTimeout(() => {\n          socketRef.current?.emit('terminal:input', sessionId, char);\n        }, index * 10);\n      });\n      // Send enter key after the message\n      setTimeout(() => {\n        socketRef.current?.emit('terminal:input', sessionId, '\\r');\n      }, message.length * 10 + 100);\n    }\n  }, [sessionId]);\n\n  return (\n    <div className=\"fixed inset-0 w-screen h-screen bg-black flex flex-col overflow-hidden\">\n      {/* Status Bar */}\n      <div className=\"flex-shrink-0 bg-gray-900 border-b border-gray-700 px-4 py-2 flex items-center justify-between\">\n        <div className=\"flex items-center gap-4\">\n          <span style={{ fontFamily: 'VT323, monospace' }} className=\"text-xl text-white\">\n            TERMINAL: {sessionId}\n          </span>\n          <div className=\"flex items-center gap-2\">\n            <div className={`w-2 h-2 rounded-full ${isConnected ? 'bg-green-500' : 'bg-red-500'}`} />\n            <span className=\"text-sm text-gray-400\">\n              {isConnected ? 'Connected' : 'Disconnected'}\n            </span>\n          </div>\n        </div>\n        <div className=\"flex items-center gap-3\">\n          {/* Toggle button */}\n          <button\n            onClick={() => setShowPreview(!showPreview)}\n            className=\"px-3 py-1.5 bg-[#00FF66] text-black font-bold rounded hover:bg-[#FFCC00] transition-colors text-sm\"\n          >\n            {showPreview ? 'TERMINAL' : 'PREVIEW'}\n          </button>\n\n          {/* Font size controls */}\n          <button\n            onClick={() => setFontSize(prev => Math.max(10, prev - 2))}\n            className=\"p-2 rounded bg-gray-800 hover:bg-gray-700 text-white active:scale-95 transition-transform\"\n            title=\"Decrease font size\"\n          >\n            <ZoomOut size={16} />\n          </button>\n          <span className=\"text-sm text-gray-400 min-w-[3ch] text-center\">{fontSize}</span>\n          <button\n            onClick={() => setFontSize(prev => Math.min(32, prev + 2))}\n            className=\"p-2 rounded bg-gray-800 hover:bg-gray-700 text-white active:scale-95 transition-transform\"\n            title=\"Increase font size\"\n          >\n            <ZoomIn size={16} />\n          </button>\n          {error && (\n            <span className=\"text-sm text-red-400 ml-4\">Error: {error}</span>\n          )}\n        </div>\n      </div>\n\n      {/* Terminal Container */}\n      <div\n        ref={terminalRef}\n        className=\"flex-1 p-2 overflow-auto\"\n        style={{\n          width: '100%',\n          display: showPreview ? 'none' : 'block'\n        }}\n      />\n\n      {/* Preview Container */}\n      {showPreview && (\n        <div className=\"flex-1 relative bg-white\">\n          <iframe\n            src=\"http://localhost:3001\"\n            className=\"absolute inset-0 w-full h-full border-0 bg-white\"\n            title=\"App Preview\"\n          />\n        </div>\n      )}\n    </div>\n  );\n}\n"],"names":[],"mappings":"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"}}]
}